<div class="iot-device-change-application-dialog">
  <h1 mat-dialog-title>{{ "IOTDEVICE.CHANGE-APPLICATION.TITLE" | translate }}</h1>
  <div mat-dialog-content>
    <label class="form-label" for="organizationSelect">{{
        "IOTDEVICE.CHANGE-APPLICATION.CHOOSE-ORGANIZATION" | translate
      }}</label>
    <mat-select
      (selectionChange)="onOrganizationChange()"
      [(value)]="iotDeviceUpdate.organizationId"
      [compareWith]="compare"
      class="form-control"
      id="organizationSelect"
      panelClass="overflow-x-hidden"
    >
      @for (organization of organizations | async; track organization) {
        <mat-option [value]="organization.id">
          {{ organization.name }}
        </mat-option>
      }
    </mat-select>
    <label class="form-label" for="organizationSelect">{{
        "IOTDEVICE.CHANGE-APPLICATION.CHOOSE-APPLICATION" | translate
      }}</label>
    <mat-select
      (selectionChange)="onApplicationChange()"
      [(value)]="iotDeviceUpdate.applicationId"
      [compareWith]="compare"
      class="form-control"
      id="applicationSelect"
      panelClass="overflow-x-hidden"
    >
      @for (application of filteredApplications | async; track application) {
        <mat-option [value]="application.id">
          {{ application.name }}
        </mat-option>
      }
    </mat-select>
    <label class="form-label" for="organizationSelect">{{
        "IOTDEVICE.CHANGE-APPLICATION.CHOOSE-DEVICE-MODEL" | translate
      }}</label>
    <mat-select
      [(value)]="iotDeviceUpdate.deviceModelId"
      [compareWith]="compare"
      class="form-control"
      id="deviceModelSelect"
      panelClass="overflow-x-hidden"
    >
      <mat-option [value]="0">
        {{ "QUESTION.DEVICE-MODEL-SELECT-NON" | translate }}
      </mat-option>
      @for (deviceModel of deviceModels; track deviceModel) {
        <mat-option [value]="deviceModel.id">
          {{ deviceModel.body.name }}
        </mat-option>
      }
    </mat-select>
  </div>

  <div class="container row" class="mt-3" mat-dialog-content>
    <a (click)="addRow()" class="btn btn-secondary my-2 mb-3 mt-3">{{
        "IOTDEVICE.CHANGE-APPLICATION.CHOOSE-DATA-TARGET" | translate
      }}</a>
    @if (payloadDecoders && iotDeviceUpdate.dataTargetToPayloadDecoderIds?.length > 0) {
      <table class="table table-striped table-bordered">
        <tbody>
        @for (element of iotDeviceUpdate.dataTargetToPayloadDecoderIds; track element; let i = $index) {
          <tr
            [attr.data-index]="i"
          >
            <td>
              <div class="row">
                <mat-form-field appearance="fill">
                  <mat-label>{{ "IOTDEVICE.CHANGE-APPLICATION.ADD-DATA-TARGET" | translate }}</mat-label>
                  <mat-select [(value)]="element.dataTargetId" name="dataTarget">
                    @for (dataTarget of dataTargets; track dataTarget) {
                      <mat-option [value]="dataTarget.id">{{
                          dataTarget.name
                        }}
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
            </td>
            <td>
              <div class="row">
                <mat-form-field appearance="fill">
                  <mat-label>{{ "QUESTION.DATATARGET.SELECT-PAYLOADDECODER" | translate }}</mat-label>
                  <mat-select [(value)]="element.payloadDecoderId" matNativeControl name="payloadDecoder">
                    <mat-option [value]="0">
                      {{ "QUESTION.DATATARGET.NO-PAYLOAD-DECODER-SELECTED" | translate }}
                    </mat-option>
                    @for (payloadDecoder of payloadDecoders; track payloadDecoder) {
                      <mat-option [value]="payloadDecoder.id">
                        {{ payloadDecoder.name }}
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
            </td>
            <td>
              <a (click)="deleteRow(i)">
                <div class="text-center m-2">
                  <fa-icon [icon]="faTimesCircle"></fa-icon>
                  <p>{{ "DATATARGET.DELETE" | translate }}</p>
                </div>
              </a>
            </td>
          </tr>
        }
        </tbody>
      </table>
    }
  </div>

  <div class="d-flex flex-row mat-dialog-actions" mat-dialog-actions>
    <button (click)="onSubmit()" class="btn btn-primary">
      {{ "GEN.SAVE" | translate }}
    </button>
    <button [mat-dialog-close]="false" class="btn btn-secondary ml-2" mat-dialog-close>
      {{ "GEN.CANCEL" | translate }}
    </button>
  </div>
</div>
