<app-top-bar [backButtonTitle]="'NAV.APPLICATION' | translate" [title]="'APPLICATION.BULK.TITLE' | translate">
</app-top-bar>
<div class="row">
  <div class="col-12">
    @if (download$ | async; as download) {
      <mat-progress-bar
        [mode]="download.state === 'PENDING' ? 'buffer' : 'determinate'"
        [value]="download.progress"
        class="mb-5"
      >
      </mat-progress-bar>
    }
  </div>
  @if (fileFormatErrorMessage) {
    <div class="error-messages p-3 col-md-10 offset-md-1 mb-5">
      <ul class="mb-0">
        {{
          "APPLICATION.BULK.FILEFORMATERRORMESSAGE" | translate
        }}
      </ul>
    </div>
  }
  <div class="col-12">
    <div class="btn-group float-md-end dropdown">
      <button
        aria-expanded="false"
        aria-haspopup="true"
        class="btn btn-primary dropdown-toggle"
        data-bs-toggle="dropdown"
        type="button"
      >
        {{ "APPLICATION.BULK.DOWNLOAD" | translate }} <span class="caret"></span>
      </button>
      <ul attr.aria-labelledby="tableRowDropdown-{{ 'APPLICATION.BULK.DOWNLOAD' | translate }}" class="dropdown-menu">
        @for (sample of samples; track sample) {
          <li class="dropdown-item">
            <a (click)="download(sample)" class="a">
              <fa-icon [icon]="faDownload"></fa-icon>
              {{ sample.name }}
            </a>
          </li>
        }
      </ul>
    </div>
  </div>
</div>
<div class="row m-3">
  <div class="col-md-6 offset-md-3 mb-5">
    <div
      (click)="fileInput.click()"
      (onFileDropped)="handleDropedFile($event)"
      appDragDrop
      attr.data-content="{{ 'APPLICATION.BULK.DROPFILE' | translate }}"
      class="choose-file"
    >
      <input
        #fileInput
        (change)="handleDropedFile($event.target.files)"
        accept=".csv"
        hidden
        ngf-max-size="20MB"
        type="file"
      />
    </div>
    @for (file of files; track file; let i = $index) {
      <div class="files-list">
        <p>{{ file }}</p>
        <button (click)="deleteAttachment(i)" class="delete-file">
          <fa-icon [icon]="faTrash"></fa-icon>
        </button>
      </div>
    }
  </div>
  <div class="col-md-6 offset-md-3 mb-5 d-flex justify-content-center">
    <button (click)="addIoTDevice()" class="btn btn-primary">Overf√∏r data</button>
  </div>
  <div class="col-md-6 mb-5">
    @if (isLoading) {
      <app-loading-spinner></app-loading-spinner>
    }
  </div>
  <div class="mat-elevation-z8">
    <table [dataSource]="bulkImportResult" class="mat-elevation-z8" mat-table>
      <ng-container matColumnDef="name">
        <th *matHeaderCellDef mat-header-cell>{{ "APPLICATION.BULK.NAME" | translate }}</th>
        <td *matCellDef="let element" mat-cell>{{ element.device?.name }}</td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th *matHeaderCellDef mat-header-cell>{{ "APPLICATION.BULK.TYPE" | translate }}</th>
        <td *matCellDef="let element" mat-cell>{{ "IOT-DEVICE-TYPES." + element.device?.type | translate }}</td>
      </ng-container>

      <ng-container matColumnDef="importStatus">
        <th *matHeaderCellDef mat-header-cell>{{ "APPLICATION.BULK.IMPORTSTATUS" | translate }}</th>
        <td *matCellDef="let element" mat-cell>{{ element.importStatus }}</td>
      </ng-container>

      <ng-container matColumnDef="errorMessages">
        <th *matHeaderCellDef mat-header-cell>{{ "APPLICATION.BULK.ERROR" | translate }}</th>
        <td *matCellDef="let element" mat-cell>
          <ul class="mb-0">
            @for (error of element.errorMessages; track error) {
              <li>
                {{ error | translate }}
              </li>
            }
          </ul>
        </td>
      </ng-container>

      <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
      <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
    </table>
  </div>
</div>
<!-- <div class="col-md-6 offset-md-3 mb-5">
<p>{{ 'APPLICATION.BULK.EMPTY' | translate }}</p>
</div> -->
